{
  "url": "https://docs.cloud.google.com/vertex-ai/generative-ai/docs/grounding/grounding-with-elasticsearch",
  "title": "Grounding with Elasticsearch  |  Generative AI on Vertex AI  |  Google Cloud Documentation",
  "text_content": "Home\nTechnology areas\nGenerative AI on Vertex AI\nDocumentation\nSend feedback\nGrounding with Elasticsearch\nStay organized with collections\nSave and categorize content based on your preferences.\nThis page explains how you can use your Elasticsearch instance to ground on your\ndata.\nGrounding Gemini with Elasticsearch\nGrounding\ninvolves using public and private\ndatasets to provide context and facts to ground Large Language Model (LLM)\nresponses. By grounding with Elasticsearch, you can take advantage of your\nexisting Elasticsearch indexes to help enhance the quality and reliability of\nGemini's output, reducing hallucinations and helping to ensure\nresponses are relevant to your data. This lets you build powerful RAG\napplications such as:\nGenerative search summaries\nQuestion-and-answer chatbots with enterprise data\nAgents grounded in your data\nYou can ground an answer on up to 10 data sources at one time. You can combine\ngrounding with Elasticsearch with\nGrounding with\nGoogle Search\nto connect the model with world knowledge, a wide possible range of topics, or\nup-to-date information on the internet.\nSupported models\nThe following\nmodels support grounding with Elasticsearch\nwith text input only:\nGemini 2.5 Flash\n(Preview)\nGemini 2.5 Flash-Lite\n(Preview)\nGemini 2.5 Flash-Lite\nGemini 2.5 Flash with Live API native audio\n(Preview)\nGemini 2.0 Flash with Live API\n(Preview)\nGemini 2.5 Pro\nGemini 2.5 Flash\nGemini 2.0 Flash\nSet up a search template in Elasticsearch\nThis section explains how you can use your Elasticsearch instance to ground on\nyour data stored in the instance.\nBest practices\nFor the best grounding responses, use these principles when creating a search\ntemplate:\nInclude only relevant and useful data. For example, in a product catalog,\nspecifying an image URL might not help the LLM answer prompts about product\nproperties unless the prompt specifically asks for a URL. Similarly, avoid\noutputting embedding vectors.\nGrounding removes Elasticsearch results with low relevance to your prompts.\nYou should provide a higher number of Elasticsearch results to capture all\nrelevant context.\nResults data can be in one field or spread across multiple fields.\nSample templates\nYou can use your search templates. However, we recommend that you use the\ngeneric kNN search template with Elasticsearch grounding. For additional search\ntemplates, see the\nGitHub repository\n.\nThis semantic search with Vertex AI is a generic kNN search.\nPUT\n_scrip\nts\n/google\n-\nte\nmpla\nte\n-\nk\nnn\n-\nmul\nt\niou\nt\npu\nt\n{\n\"script\"\n:\n{\n\"lang\"\n:\n\"mustache\"\n,\n\"source\"\n:\n{\n\"_source\"\n:\n{\n\"excludes\"\n:\n[\n\"title_embedding\"\n,\n\"description_embedding\"\n,\n\"images\"\n]\n},\n\"size\"\n:\n\"num_hits\"\n,\n\"knn\"\n:\n[\n{\n\"field\"\n:\n\"description_embedding\"\n,\n\"k\"\n:\n5\n,\n\"num_candidates\"\n:\n10\n,\n\"query_vector_builder\"\n:\n{\n\"text_embedding\"\n:\n{\n\"model_id\"\n:\n\"googlevertexai_embeddings_004\"\n,\n\"model_text\"\n:\n\"query\"\n}\n},\n\"boost\"\n:\n0.4\n},\n{\n\"field\"\n:\n\"title_embedding\"\n,\n\"k\"\n:\n5\n,\n\"num_candidates\"\n:\n10\n,\n\"query_vector_builder\"\n:\n{\n\"text_embedding\"\n:\n{\n\"model_id\"\n:\n\"googlevertexai_embeddings_004\"\n,\n\"model_text\"\n:\n\"query\"\n}\n},\n\"boost\"\n:\n0.6\n}\n]\n}\n}\n}\nGenerate grounded responses with Elasticsearch\nThis section explains how you use the Vertex AI API to ground your LLM\nresponses.\nPrerequisites\nBefore you can ground LLM responses with Elasticsearch, you must complete the\nfollowing:\nActivate the Vertex AI API\n: Ensure that both the\nVertex AI API is enabled for your Google Cloud project.\nInstall and sign in to the Google Cloud CLI CLI\n: Install and initialize\nthe gcloud CLI\ncommand-line tool\n.\nElasticsearch setup\n: Use an existing Elasticsearch cluster and index that\nyou want to use for grounding. Obtain the following information from your\nElasticsearch setup:\nEndpoint\n: The URL of your Elasticsearch cluster.\nIndex Name\n: The name of the index you want to search such as\nmy-data-index\n.\nAPI Key\n: An API key that allows access to your Elasticsearch cluster.\nThe API key must start with the prefix\nApiKey\n.\nCreate an Elasticsearch search template\n: Use an Elasticsearch data source\nthat uses a reference\ntemplate\nthat returns result data\nfor grounding.\nGenerate grounded responses\nConsole\nTo ground with Elasticsearch in the Google Cloud console, do the following:\nGo to Vertex AI Studio to the\nCreate prompt\npage.\nGo to Create prompt\nIn the\nSettings\npanel, to ground your data, click the\nGrounding: Your\ndata\ntoggle.\nIn the\nCustomize Grounding\npane, select\nElasticsearch\n.\nEnter the endpoint in the\nElasticsearch endpoint\nfield.\nEnter\nApiKey YOUR_API_KEY\nin the\nElasticsearch API Key\nfield.\nEnter the index in the\nElasticsearch index\nfield.\nEnter the search template in the\nElasticsearch search template\nfield.\nAdjust the number of hits by sliding the\nNumber of hits\nslider.\nClick\nSave\n.\nEnter your prompt.\nClick\nSubmit\n.\nUnderstand your response\nIf your model prompt successfully grounds to Elasticsearch data stores using the\nVertex AI Studio or the API, then the model's responses include\nmetadata with citations and source content. If low-source relevance or\nincomplete information occurs within the model's response, then metadata might\nnot be provided, and the prompt response won't be grounded.\nPython\nInstall\npip install --upgrade google-genai\nTo learn more, see the\nSDK reference documentation\n.\nSet environment variables to use the Gen AI SDK with Vertex AI:\n# Replace the `GOOGLE_CLOUD_PROJECT` and `GOOGLE_CLOUD_LOCATION` values\n# with appropriate values for your project.\nexport\nGOOGLE_CLOUD_PROJECT\n=\nGOOGLE_CLOUD_PROJECT\nexport\nGOOGLE_CLOUD_LOCATION\n=\nglobal\nexport\nGOOGLE_GENAI_USE_VERTEXAI\n=\nTrue\nfrom\ngoogle\nimport\ngenai\nfrom\ngoogle.genai.types\nimport\n(\nGenerateContentConfig\n,\nElasticsearch\n,\nRetrieval\n,\nTool\n,\nHttpOptions\n,\n)\nclient\n=\ngenai\n.\nClient\n(\nhttp_options\n=\nHttpOptions\n(\napi_version\n=\n\"v1\"\n))\n# Replace with your Elasticsearch details\nELASTIC_SEARCH_ENDPOINT\n=\n\"YOUR_ELASTICSEARCH_ENDPOINT\"\nELASTIC_SEARCH_API_KEY\n=\n\"YOUR_ELASTICSEARCH_API_KEY\"\nINDEX_NAME\n=\n\"YOUR_INDEX_NAME\"\nSEARCH_TEMPLATE_NAME\n=\n\"YOUR_SEARCH_TEMPLATE_NAME\"\nNUM_HITS\n=\n5\ntool\n=\nTool\n(\nretrieval\n=\nRetrieval\n(\nexternal_api\n=\nElasticsearch\n(\napi_spec\n=\n\"ELASTIC_SEARCH\"\n,\nendpoint\n=\nELASTIC_SEARCH_ENDPOINT\n,\napi_auth\n=\n{\n\"apiKeyConfig\"\n:\n{\n\"apiKeyString\"\n:\nf\n\"ApiKey\n{\nELASTIC_SEARCH_API_KEY\n}\n\"\n}\n},\nelastic_search_params\n=\n{\n\"index\"\n:\nINDEX_NAME\n,\n\"searchTemplate\"\n:\nSEARCH_TEMPLATE_NAME\n,\n\"numHits\"\n:\nNUM_HITS\n,\n},\n)\n)\n)\nresponse\n=\nclient\n.\nmodels\n.\ngenerate_content\n(\nmodel\n=\n\"gemini-2.5-flash\"\n,\n# Or another supported model\ncontents\n=\n\"What are the main features of product X?\"\n,\n# Your query\nconfig\n=\nGenerateContentConfig\n(\ntools\n=\n[\ntool\n],\n),\n)\nprint\n(\nresponse\n.\ntext\n)\nREST\nTo send a text prompt and ground it with Elasticsearch, send a POST request to\nthe Vertex AI API. At a minimum, you must provide the request\nbody. Make sure to do the following replacements:\nPROMPT\n: The text prompt to ground.\nELASTIC_SEARCH_ENDPOINT\n: The absolute endpoint path for\nthe Elasticsearch resource to use.\nELASTIC_SEARCH_API_KEY\n: The API key for the Elasticsearch\ndata endpoint.\nINDEX_NAME\n: The name of the Elasticsearch index used for\ngrounding.\nSEARCH_TEMPLATE_NAME\n: The Elasticsearch search template\nused for grounding.\nNUM_HITS\n: The number of results returned from the\nElasticsearch data source and used for grounding.\nHTTP method and URL:\nPOST\nhttps://\nLOCATION\n-aiplatform.googleapis.com/v1beta1/projects/\nPROJECT_ID\n/locations/\nLOCATION\n/publishers/google/models/\nMODEL_ID\n:generateContent\nRequest JSON body:\n{\n\"contents\"\n:\n[\n{\n\"role\"\n:\n\"user\"\n,\n\"parts\"\n:\n[\n{\n\"text\"\n:\n\"\nPROMPT\n\"\n}\n]\n}\n],\n\"tools\"\n:\n[{\n\"retrieval\"\n:\n{\n\"externalApi\"\n:\n{\n\"api_spec\"\n:\n\"ELASTIC_SEARCH\"\n,\n\"endpoint\"\n:\n\"\nELASTIC_SEARCH_ENDPOINT\n\"\n,\n\"apiAuth\"\n:\n{\n\"apiKeyConfig\"\n:\n{\n\"apiKeyString\"\n:\n\"ApiKey\nELASTIC_SEARCH_API_KEY\n\"\n}\n},\n\"elasticSearchParams\"\n:\n{\n\"index\"\n:\n\"\nINDEX_NAME\n\"\n,\n\"searchTemplate\"\n:\n\"\nSEARCH_TEMPLATE_NAME\n\"\n,\n\"numHits\"\n:\n\"\nNUM_HITS\n\"\n,\n}\n}\n}\n}]\n}\nFor more information on other API fields such as system instructions and\nmulti-turn chats, see\nGenerative AI beginner's guide\n.\nSend the API request\nYou can save the request body in a file named\nrequest.json\n.\nThen execute the POST API request, and do the following replacements:\nLOCATION\n: The region to process the request. To use the\nglobal endpoint\n, exclude the location from the endpoint name, and configure the location of the resource to\nglobal\n.\nPROJECT_ID\n: Your Google Cloud project ID. For more information on project IDs, see\nCreating and managing projects\n.\nMODEL_ID\n: The model ID of the multimodal model.\ncurl\n-X\nPOST\n\\\n-H\n\"Authorization: Bearer\n$(\ngcloud\nauth\nprint-access-token\n)\n\"\n\\\n-H\n\"Content-Type: application/json; charset=utf-8\"\n\\\n-d\n@request.json\n\\\n\"https://\nLOCATION\n-aiplatform.googleapis.com/v1beta1/projects/\nPROJECT_ID\n/locations/\nLOCATION\n/publishers/google/models/\nMODEL_ID\n:generateContent\"\nYou should receive a JSON response similar to the following:\n{\n\"candidates\"\n:\n[\n{\n\"content\"\n:\n{\n\"role\"\n:\n\"model\"\n,\n\"parts\"\n:\n[\n{\n\"text\"\n:\n\"Based on the information ...\"\n}\n]\n},\n\"finishReason\"\n:\n\"STOP\"\n,\n\"safetyRatings\"\n:\n[\n\"...\"\n],\n\"groundingMetadata\"\n:\n{\n\"groundingChunks\"\n:\n[\n{\n\"retrievedContext\"\n:\n{\n\"text\"\n:\n\"ipsum lorem ...\"\n}\n},\n{\n...\n},\n{\n...\n},\n],\n\"groundingSupports\"\n:\n[\n{\n\"segment\"\n:\n{\n\"startIndex\"\n:\n25\n,\n\"endIndex\"\n:\n147\n,\n\"text\"\n:\n\"ipsum lorem ...\"\n},\n\"groundingChunkIndices\"\n:\n[\n1\n,\n2\n],\n\"confidenceScores\"\n:\n[\n0.6626542\n,\n0.82018316\n],\n},\n],\n},\n}\n],\n}\nUnderstand your response\nThe response from both APIs include the LLM-generated text, which is called a\ncandidate\n. If your model prompt successfully grounds to your Elasticsearch\ndata source, then the responses include grounding metadata, which identifies the\nparts of the response that were derived from your Elasticsearch data. However,\nthere are several reasons this metadata might not be provided, and the prompt\nresponse won't be grounded. These reasons include low-source relevance or\nincomplete information within the model's response.\nThe following is a breakdown of the output data:\nRole\n: Indicates the sender of the grounded answer. Because the response\nalways contains grounded text, the role is always\nmodel\n.\nText\n: The grounded answer generated by the LLM.\nGrounding metadata\n: Information about the grounding source, which contains\nthe following elements:\nGrounding chunks\n: A list of results from your Elasticsearch index that\nsupport the answer.\nGrounding supports\n: Information about a specific claim within the answer\nthat can be used to show citations:\nSegment\n: The part of the model's answer that is substantiated by a\ngrounding chunk.\nGrounding chunk index\n: The index of the grounding chunks in the\ngrounding chunks list that corresponds to this claim.\nConfidence scores\n: A number from 0 to 1 that indicates how grounded\nthe claim is in the provided set of grounding chunks. Not available for\nGemini 2.5 Pro and Gemini 2.5 Flash and later.\nWhat's next\nTo learn how to send chat prompt requests, see\nMultiturn chat\n.\nTo learn about responsible AI best practices and Vertex AI's safety filters,\nsee\nSafety best practices\n.\nSend feedback\nExcept as otherwise noted, the content of this page is licensed under the\nCreative Commons Attribution 4.0 License\n, and code samples are licensed under the\nApache 2.0 License\n. For details, see the\nGoogle Developers Site Policies\n. Java is a registered trademark of Oracle and/or its affiliates.\nLast updated 2025-11-07 UTC.",
  "metadata": {
    "title": "Grounding with Elasticsearch  |  Generative AI on Vertex AI  |  Google Cloud Documentation",
    "extracted_at": "2025-11-11 14:26:40"
  }
}